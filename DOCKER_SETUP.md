# üê≥ Docker Setup - Dev/Prod —Ä–µ–∂–∏–º—ã

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–¥–∏–Ω—ã–π `docker-compose.yml` –∏ `Dockerfile` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ production –Ω–∞ VPS, —Å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `ENVIRONMENT`.

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

- `docker-compose.yml` - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –¥–ª—è dev –∏ prod)
- `docker-compose.override.yml.example` - –ø—Ä–∏–º–µ—Ä override —Ñ–∞–π–ª–∞ –¥–ª—è dev —Ä–µ–∂–∏–º–∞
- `Dockerfile` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π Dockerfile –¥–ª—è backend
- `start.sh` - —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ backend (–≤—ã–±–∏—Ä–∞–µ—Ç uvicorn/gunicorn –Ω–∞ –æ—Å–Ω–æ–≤–µ ENVIRONMENT)
- `.env` - —Ñ–∞–π–ª —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –≤ git)

## üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤

–†–µ–∂–∏–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `ENVIRONMENT` –≤ —Ñ–∞–π–ª–µ `.env`:
- `ENVIRONMENT=dev` - —Ä–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (uvicorn —Å hot-reload)
- `ENVIRONMENT=prod` - —Ä–µ–∂–∏–º production (gunicorn)

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (dev)

1. **–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª** (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω):
   ```bash
   # –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ ENVIRONMENT=dev
   ENVIRONMENT=dev
   # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
   ```

2. **–°–æ–∑–¥–∞–π—Ç–µ `docker-compose.override.yml`** –¥–ª—è hot-reload:
   ```bash
   cp docker-compose.override.yml.example docker-compose.override.yml
   ```
   –≠—Ç–æ —Ñ–∞–π–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ `docker-compose.yml` –∏ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è hot-reload.

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã**:
   ```bash
   docker compose up --build
   ```
   Backend –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ `uvicorn` —Å —Ñ–ª–∞–≥–æ–º `--reload`, –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

### Production (VPS)

1. **–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª** –Ω–∞ VPS:
   ```bash
   # –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ ENVIRONMENT=prod
   ENVIRONMENT=prod
   # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
   ```

2. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `docker-compose.override.yml` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç** (–∏–ª–∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω)

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã**:
   ```bash
   docker compose up --build -d
   ```
   Backend –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ `gunicorn` —Å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–ª—è production.

## üìù –ü—Ä–∏–º–µ—Ä .env —Ñ–∞–π–ª–∞

```env
# –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: dev (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞) –∏–ª–∏ prod (production)
ENVIRONMENT=prod

# –ì–ò–ë–†–ò–î–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø LLM
BASE_URL=https://api.deepseek.com/v1
API_KEY=–≤–∞—à_–∫–ª—é—á_deepseek
OPENAI_BASE_URL=https://api.proxyapi.ru/openai/v1
OPENAI_API_KEY=–≤–∞—à_–∫–ª—é—á_proxyapi

# Redis
REDIS_URL=redis://redis:6379

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
W=1440
Price=1000
ShopID=–≤–∞—à_shop_id_—é–∫–∞—Å—Å—ã
Ykassa_API=–≤–∞—à_api_–∫–ª—é—á_—é–∫–∞—Å—Å—ã

# Frontend URL
FRONTEND_URL=http://localhost:3000
```

## üîç –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### Backend Dockerfile

`Dockerfile` –∫–æ–ø–∏—Ä—É–µ—Ç `start.sh` —Å–∫—Ä–∏–ø—Ç –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ –∫–∞–∫ `CMD`. –°–∫—Ä–∏–ø—Ç `start.sh`:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `ENVIRONMENT` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `prod`)
- –ï—Å–ª–∏ `ENVIRONMENT=dev` ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç `uvicorn` —Å `--reload`
- –ï—Å–ª–∏ `ENVIRONMENT=prod` ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç `gunicorn` —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –∏–∑ `gunicorn.conf.py`

### Docker Compose

- `docker-compose.yml` - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª, –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –¥–ª—è dev –∏ prod
- `docker-compose.override.yml` (—Å–æ–∑–¥–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–µ –≤ git):
  - –ú–æ–Ω—Ç–∏—Ä—É–µ—Ç `./app` –≤ `/app/app` –¥–ª—è hot-reload
  - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ dev —Ä–µ–∂–∏–º–µ (—Ñ–∞–π–ª —Å–æ–∑–¥–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ)

### Frontend –∏ Admin Frontend

Frontend –∏ Admin Frontend –≤—Å–µ–≥–¥–∞ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ production —Ä–µ–∂–∏–º–µ (—á–µ—Ä–µ–∑ `npm run build` –∏ nginx). –î–ª—è dev —Ä–µ–∂–∏–º–∞ frontend —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–ø—É—Å–∫–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ `npm run dev`.

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —ç—Ç–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

1. **–ï–¥–∏–Ω—ã–π –∫–æ–¥**: –æ–¥–∏–Ω `docker-compose.yml` –∏ `Dockerfile` –¥–ª—è –≤—Å–µ—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π
2. **–ì–∏–±–∫–æ—Å—Ç—å**: –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `ENVIRONMENT`
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: `docker-compose.override.yml` –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ git
4. **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è dev/prod

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Backend –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞ (dev —Ä–µ–∂–∏–º)

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `docker-compose.override.yml` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç volumes –¥–ª—è `./app`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ `.env` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ `ENVIRONMENT=dev`
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: `docker compose restart backend`

### Backend –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ uvicorn –≤ production

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ `.env` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ `ENVIRONMENT=prod`
- –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑: `docker compose build backend`
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ: `docker compose up -d backend`









